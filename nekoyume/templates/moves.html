{% extends 'layout.html' %}
{% set avatar = g.user.avatar() %}
{% block title -%} Moves {%- endblock %}

{% macro name_of(monster) %}
<a href="{{ monster['url'] }}">{{ monster['id'] }}</a>
{% endmacro %}
{% block style %}
<style>
    .move, .move-bar, .avatar-status {
        margin-bottom: 20px;
        width:100%;
    }

    .avatar-profile-image {
        width: 16px;
        height: 16px;
        border-radius: 100%;
        margin-right: 6px;
        margin-top: -2px;
    }

    .avatar-status  {
        width: 100%;
    }

    .avatar-status ul {
        padding-left: 20px;
    }

    .avatar-status li {
        list-style: none;
    }

    .move.sleep > .mdl-card__title {
        color: #fff;
        height: 176px;
        background: #5a6f91;
    }

    .mdl-card__supporting-text {
      width: auto;
    }

    .level-up-button {
        cursor: pointer;
    }
</style>
{% endblock %}
{% block body %}
<div class = "mdl-layout mdl-js-layout">
    <div class = "mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <header class = "mdl-layout__header">
            <div class = "mdl-layout__header-row">
                <!-- Title -->
                <span class="mdl-layout-title">Nekøyume</span>
                <!-- Add spacer, to align navigation to the right -->
                <div class="mdl-layout-spacer"></div>
                <!-- Navigation. We hide it in small screens. -->
                <nav class="mdl-navigation mdl-layout--large-screen-only">
                    <span><strong>{% trans -%}Address{%- endtrans %}:&nbsp;</strong> {{ g.user.address }}</span>
                </nav>
            </div>
        </header>
        <div id="avatar-status" class="mdl-layout__drawer">
            <!-- Title -->
            <span class="mdl-layout-title">Nekøyume</span>
            <!-- Add spacer, to align navigation to the right -->
            <div class="mdl-layout-spacer"></div>
            <!-- Navigation. We hide it in small screens. -->
            <nav class="mdl-navigation mdl-layout--large-screen-only">
              <a class="mdl-navigation__link" href="https://nekoyu.me/">{% trans -%}Homepage{%- endtrans %}</a>
              <a class="mdl-navigation__link" href="{% trans -%}https://www.dungeonworldsrd.com/{%- endtrans %}">{% trans -%}Learn Dungeon World{%- endtrans %}</a>
              <a class="mdl-navigation__link" href="https://nekoyu.me/token">{% trans -%}Buy Gold{%- endtrans %}</a>
              <a class="mdl-navigation__link" href="https://github.com/nekoyume">Github</a>
              <a class="mdl-navigation__link" href="{{ url_for('game.export_private_key') }}">{% trans -%}Export Private Key{%- endtrans %}</a>
              <a class="mdl-navigation__link" href="{{ url_for('game.get_logout') }}">{% trans -%}Logout{%- endtrans %}</a>
            </nav>
        </div>
        <main class="mdl-layout__content">
            <div class="mdl-grid">
                <div class="mdl-cell mdl-cell--3-col"></div>
                <div class="mdl-cell mdl-cell--6-col mdl-cell--8-col-tablet">
                    <a href="{{ url_for('game.get_dashboard') }}">Back to dashboard</a>
                    <div class="moves">
                        {% for move in feed.limit(10) %}
                        <div class="move-{{ move.id }}">
                            {% set move_avatar, result = move.execute() %}
                            {% if result.type == 'create_novice' %}
                            <div class="move mdl-card mdl-shadow--2dp
                                        {% if 'last_block' in request.values and move.block_id > request.values.get('last_block')|int %}highlight{% endif %}">
                                <div class="mdl-card__supporting-text">
                                  <sub><img src="{{ move_avatar.profile_image_url }}" alt="{{ avatar.name }} profile image" class="avatar-profile-image"> <b>{{ move_avatar.name }}</b> ∙ {{ move.created_at }}</sub>
                                  <hr>
                                </div>
                                <div class="mdl-card__title mdl-card--expand">
                                    <h2 class="mdl-card__title-text">
                                  👶 {% trans -%}Novice was born!{%- endtrans %}</h2>
                                </div>
                                <div class="mdl-card__supporting-text">
                                    <h5>{% trans -%}Welcome!{%- endtrans %}</h5>
                                    {% include 'basic_info.html' %}
                                </div>
                            </div>
                            {% elif result.type == 'hack_and_slash' %}
                            <div class="move mdl-card mdl-shadow--2dp
                                        {% if 'last_block' in request.values and move.block_id > request.values.get('last_block')|int %}highlight{% endif %}">
                                <div class="mdl-card__supporting-text">
                                  <sub><img src="{{ move_avatar.profile_image_url }}" alt="{{ avatar.name }} profile image" class="avatar-profile-image"> <b>{{ move_avatar.name }}</b> ∙ {{ move.created_at }}</sub>
                                  <hr>
                                </div>
                                {% if result.result == 'win' %}
                                <div class="mdl-card__title mdl-card--expand">
                                    <h2 class="mdl-card__title-text">👍 {% trans -%}You won the battle!{%- endtrans %}</h2>
                                </div>
                                {% elif result.result == 'finish' %}
                                <div class="mdl-card__title mdl-card--expand">
                                    <h2 class="mdl-card__title-text">😐 {% trans -%}Battle was finished.{%- endtrans %}</h2>
                                </div>
                                {% else %}
                                <div class="mdl-card__title mdl-card--expand">
                                    <h2 class="mdl-card__title-text">😭 {% trans -%}You lost the battle. {%- endtrans %}</h2>
                                </div>
                                {% endif %}
                                <div class="mdl-card__supporting-text">
                                    <ol>
                                        {% for status in result.battle_status %}
                                        {% if status['type'] == 'attack_monster' %}
                                        <li>
                                          💥
                                          {% trans monster=name_of(status['monster']),
                                                   damage=status['damage'],
                                                   monster_hp=status['monster']['hp'],
                                                   monster_hp_after_damage = status['monster']['hp'] - status['damage'] -%}
                                          You attacked {{ monster }} and wounded it for <strong>{{ damage }}</strong> damage. <small>(HP {{ monster_hp }} → {{ monster_hp_after_damage }})</small>
                                          {%- endtrans %}
                                        </li>
                                        {% elif status['type'] == 'attacked_by_monster' %}
                                        <li>
                                          😫
                                          {% trans monster=name_of(status['monster']),
                                                   damage=status['damage'] -%}
                                          You are attacked by {{ monster }} and take <strong>{{ damage }}</strong> damage.
                                          {%- endtrans %}
                                        </li>
                                        {% elif status['type'] == 'get_xp' %}
                                        <li>
                                          🤔
                                          {% trans -%}
                                          You learned from your previous mistake. <small>(XP +1)</small>
                                          {%- endtrans %}
                                        </li>
                                        {% elif status['type'] == 'kill_monster' %}
                                        <li>
                                          ☠️
                                          {% trans monster=name_of(status['monster']) -%}
                                          You defeated {{ monster }}!
                                          {%- endtrans %}
                                        </li>
                                        {% elif status['type'] == 'killed_by_monster' %}
                                        <li>
                                          ☠️
                                          {% trans monster=name_of(status['monster']) -%}
                                          You are defeated by {{ monster }}...
                                          {%- endtrans %}
                                        </li>
                                        {% elif status['type'] == 'run' %}
                                        <li>
                                          🏃
                                          {% trans monster=name_of(status['monster']) -%}
                                          {{ monster }} has run away...
                                          {%- endtrans %}
                                        </li>
                                        {% elif status['type'] == 'get_item' %}
                                        <li>
                                          🎁
                                          {% trans item=status['item'] -%}
                                          You obtained {{ item }}!
                                          {%- endtrans %}
                                        </li>
                                        {% elif status['type'] == 'item_use' %}
                                        <li>
                                          🎁
                                          {% trans item=status['item'], status_change=status['status_change'] -%}
                                          You used {{ item }}. <small>({{ status_change }})</small>
                                          {%- endtrans %}
                                        </li>
                                        {% elif status['type'] == 'item_use_fail' %}
                                        <li>
                                          🎁
                                          {% trans item=status['item'], status_change=status['status_change'] -%}
                                          You tried to use {{ item }} but it doesn't works.
                                          {%- endtrans %}
                                        </li>
                                        {% else %}
                                        <li>
                                          {{ status }}
                                        </li>
                                        {% endif %}
                                        {% endfor %}
                                    </ol>
                                </div>
                            </div>
                            {% elif result.type == 'level_up' %}
                            <div class="move mdl-card mdl-shadow--2dp
                                        {% if 'last_block' in request.values and move.block_id > request.values.get('last_block')|int %}highlight{% endif %}">
                                <div class="mdl-card__supporting-text">
                                  <sub><img src="{{ move_avatar.profile_image_url }}" alt="{{ avatar.name }} profile image" class="avatar-profile-image"> <b>{{ move_avatar.name }}</b> ∙ {{ move.created_at }}</sub>
                                  <hr>
                                </div>
                                {% if result.result == 'success' %}
                                <div class="mdl-card__title">
                                    <h2 class="mdl-card__title-text">🆙 {% trans lv=move_avatar.lv -%}Level Up! Now, your level is {{ lv }}.{%- endtrans %}</h2>
                                </div>
                                {% else %}
                                <div class="mdl-card__title">
                                    <h2 class="mdl-card__title-text">😐 {% trans lv=move_avatar.lv -%}Level up was failed{%- endtrans %}</h2>
                                </div>
                                {% endif %}
                                <div class="mdl-card__supporting-text">
                                    {% if result.message %}
                                    <p>{{ result.message }}</p>
                                    {% endif %}
                                </div>
                            </div>
                            {% elif result.type == 'sleep' %}
                            <div class="move sleep mdl-card mdl-shadow--2dp
                                        {% if 'last_block' in request.values and move.block_id > request.values.get('last_block')|int %}highlight{% endif %}">
                                <div class="mdl-card__supporting-text">
                                  <sub><img src="{{ move_avatar.profile_image_url }}" alt="{{ avatar.name }} profile image" class="avatar-profile-image"> <b>{{ move_avatar.name }}</b> ∙ {{ move.created_at }}</sub>
                                </div>
                                <div class="mdl-card__title mdl-card--expand">
                                    <h2 class="mdl-card__title-text">
                                    💤
                                    {% trans -%}
                                    HP was recovered by sleep.
                                    {%- endtrans %}
                                    </h2>
                                </div>
                            </div>
                            {% elif result.type == 'say' %}
                            <div class="move mdl-card mdl-shadow--2dp
                                        {% if 'last_block' in request.values and move.block_id > request.values.get('last_block')|int %}highlight{% endif %}">
                                <div class="mdl-card__supporting-text">
                                  <sub><img src="{{ move_avatar.profile_image_url }}" alt="{{ avatar.name }} profile image" class="avatar-profile-image"> <b>{{ move_avatar.name }}</b> ∙ {{ move.created_at }}</sub>
                                  <hr>
                                </div>
                                <div class="mdl-card__title">
                                    <h2 class="mdl-card__title-text">🗣 {{ result['message'] }}</h2>
                                </div>
                            </div>
                            {% elif result.type == 'send' %}
                            <div class="move mdl-card mdl-shadow--2dp
                                        {% if 'last_block' in request.values and move.block_id > request.values.get('last_block')|int %}highlight{% endif %}">
                                <div class="mdl-card__supporting-text">
                                  <sub><img src="{{ move_avatar.profile_image_url }}" alt="{{ avatar.name }} profile image" class="avatar-profile-image"> <b>{{ move_avatar.name }}</b> ∙ {{ move.created_at }}</sub>
                                  <hr>
                                </div>
                                <div class="mdl-card__title mdl-card--expand">
                                    <h2 class="mdl-card__title-text">🎁
                                    {% trans amount=move.details['amount'], item=move.details['item_name'] -%}
                                    You delievered {{ amount }} of {{ item }}.
                                    {%- endtrans %}
                                    </h2>
                                </div>
                                <div class="mdl-card__supporting-text">
                                    <p>{% trans -%}Receiver: {%- endtrans %}{{ move.details['receiver'] }} </p>
                                </div>
                            </div>
                            {% elif result.type == 'combine' %}
                            <div class="move mdl-card mdl-shadow--2dp
                                        {% if 'last_block' in request.values and move.block_id > request.values.get('last_block')|int %}highlight{% endif %}">
                                <div class="mdl-card__supporting-text">
                                  <sub><img src="{{ move_avatar.profile_image_url }}" alt="{{ avatar.name }} profile image" class="avatar-profile-image"> <b>{{ move_avatar.name }}</b> ∙ {{ move.created_at }}</sub>
                                  <hr>
                                </div>
                                <div class="mdl-card__title">
                                    <h2 class="mdl-card__title-text">
                                    {% if result.result == 'success' %}
                                    🙌
                                    {% trans result=result.result_item%}
                                    You created {{ result }}.
                                    {%- endtrans %}
                                    {% else %}
                                    😩
                                    {% trans -%}
                                    Your combination was failed.
                                    {%- endtrans %}
                                    {% endif %}
                                    </h2>
                                </div>
                                <div class="mdl-card__supporting-text">
                                    <p>{% trans item1=move.details['item1'],
                                                item2=move.details['item2'],
                                                item3=move.details['item3'] -%}
                                       Ingredients: {{ item1 }}, {{ item2 }}, and {{ item3 }}
                                       {%- endtrans %} </p>
                                </div>
                            </div>
                            {% else %}
                            <div class="move mdl-card mdl-shadow--2dp
                                        {% if 'last_block' in request.values and move.block_id > request.values.get('last_block')|int %}highlight{% endif %}">
                                <div class="mdl-card__supporting-text">
                                  <sub><img src="{{ move_avatar.profile_image_url }}" alt="{{ avatar.name }} profile image" class="avatar-profile-image"> <b>{{ move_avatar.name }}</b> ∙ {{ move.created_at }}</sub>
                                  <hr>
                                </div>
                                <div class="mdl-card__title mdl-card--expand">
                                    <h2 class="mdl-card__title-text">Move</h2>
                                </div>
                                <div class="mdl-card__supporting-text">
                                    <p>{{ result }}</p>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}


